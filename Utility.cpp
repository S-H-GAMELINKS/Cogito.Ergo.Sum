// Utility Source

#include "DxLib.h"
#include "ConstantExpressionVariable.h"
#include "GameMenu.h"
#include "SaveData.h"
#include "ConfigMenu.h"
#include <thread>
#include <chrono>

//ゲームタイトル名
extern const char* GameTitle;

extern int SP, CP;	// 参照する文字列番号と文字列中の文字ポインタ

//終了フラグ
extern int EndFlag;

//tempデータ
extern int EndFlagTemp, SP_Temp;

namespace {

	//処理停止時間計算関数
	template <typename T>
	decltype(auto) WaitTimeCalc(const T var) {
		return var * var;
	}
}

//メッセージボックス(Yes or No)
int MessageBoxYesNo(LPCTSTR lpText) noexcept
{
	return MessageBox(
		DxLib::GetMainWindowHandle(),
		lpText,
		GameTitle,
		MB_YESNO
	);
}

//メッセージボックス(OK)
int MessageBoxOk(LPCTSTR lpText) noexcept
{
	return MessageBox(
		DxLib::GetMainWindowHandle(),
		lpText,
		GameTitle,
		MB_OK
	);
}

//画面クリア処理関数
void ScreenClear() noexcept {
	SetDrawScreen(DX_SCREEN_BACK);
	ClearDrawScreen();
	SetDrawScreen(DX_SCREEN_FRONT);
}

//ゲーム終了確認ウインドウ
void GameEndMessageBox() {

		if (IDYES == MessageBoxYesNo("終了しますか？"))
			EndFlag = 99;

		if (EndFlag != 99 && EndFlag != 0)
			std::this_thread::sleep_for(std::chrono::milliseconds(WaitTimeCalc(wait_key_task_time) / wait_game_time));
		else
			std::this_thread::sleep_for(std::chrono::milliseconds(wait_key_task_time));
}

//各種ショートカットキー
void ShortCutKey() {

	if (DxLib::CheckHitKey(KEY_INPUT_F1) == 1)
		SaveDataLoop(1);

	if (DxLib::CheckHitKey(KEY_INPUT_F2) == 1)
		SaveDataLoop(2);

	if (DxLib::CheckHitKey(KEY_INPUT_F3) == 1)
		SaveDataLoop(3);

	//if (DxLib::CheckHitKey(KEY_INPUT_F4) == 1)

	//if (DxLib::CheckHitKey(KEY_INPUT_F5) == 1)

	//if (DxLib::CheckHitKey(KEY_INPUT_F6) == 1)

	//if (DxLib::CheckHitKey(KEY_INPUT_F7) == 1)

	//if (DxLib::CheckHitKey(KEY_INPUT_F8) == 1)

	if (DxLib::CheckHitKey(KEY_INPUT_F9) == 1)
		ConfigMenuLoop();

	//if (DxLib::CheckHitKey(KEY_INPUT_F10) == 1)

	//if (DxLib::CheckHitKey(KEY_INPUT_F11) == 1)

	if (DxLib::CheckHitKey(KEY_INPUT_BACK) == 1) {
		SaveDataScreenShotGet();
		EndFlagTemp = EndFlag;
		SP_Temp = SP;
		SP = 0;
		EndFlag = 17;
	}

	//ゲーム終了確認ウインドウ
	if (CheckHitKey(KEY_INPUT_ESCAPE) == 1)
		GameEndMessageBox();
}